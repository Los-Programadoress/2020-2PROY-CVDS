<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 
  <mapper namespace="edu.eci.cvds.persistence.mybatisimpl.mappers.EquipoMapper">
  <resultMap type='Equipo' id='EquipoResult'>
    <id property='numero' column='numero' />
    <result property='nombre' column='nombre' />
    <result property='marca' column='marca' />
    <result property='disponible' column='disponible' />
    <result property='dadoDeBaja' column='dadoDeBaja' />
    <association property="usuario" resultMap='edu.eci.cvds.persistence.mybatisimpl.mappers.UsuarioMapper.UsuarioResult'></association>
    <collection property='elementos' ofType='Elemento' resultMap='edu.eci.cvds.persistence.mybatisimpl.mappers.ElementoMapper.ElementoResult' columnPrefix='elem_'></collection>
    <collection property='novedades' ofType='Novedad' resultMap='edu.eci.cvds.persistence.mybatisimpl.mappers.NovedadMapper.NovedadResult' columnPrefix='noved_'></collection>      
  </resultMap>
 
  <select parameterType="map" id="consultarEquipos" resultMap="EquipoResult">
  	SELECT
      e.numero,
      e.nombre,
      e.marca,
      e.disponible,
      e.dadoDeBaja
    FROM equipo AS e
  </select>
  
  <select parameterType="map" id="consultarEquipo" resultMap="EquipoResult">
  	SELECT
      e.numero,
      e.nombre,
      e.marca,
      e.disponible
      e.dadoDeBaja
    FROM equipo AS e
    WHERE e.numero = #{nequipo}
  </select>
  
  <insert parameterType="map" id="registrarEquipo">
    INSERT INTO EQUIPO (nombre, marca, disponible, usuario_idCorreo) 
    VALUES (#{nombre}, #{marca}, #{disponible}, #{uidcorreo});
  </insert>
  
  <select parameterType="map" id="consultarElementosEquipo" resultMap="edu.eci.cvds.persistence.mybatisimpl.mappers.ElementoMapper.ElementoResult">
   SELECT
      el.id,
      el.tipo,
      e.nombre,
      el.nombre,
      el.disponible
    FROM equipo AS e
    LEFT JOIN elemento AS el ON e.numero = el.numEquipo
    WHERE e.numero = #{nequipo}
  </select>
  
  <update parameterType="map" id="asociarEquipo">
 	UPDATE equipo
  	SET nombreLab = #{nLab}, disponible = #{disponible}
  	WHERE numero = #{nume}
  </update>
  
  <update parameterType="map" id="desasociarEquipo">
	UPDATE equipo
	SET nombreLab = null, disponible = #{disp}
	WHERE nombreLab = #{nLab}
  </update>
  
  <update parameterType="map" id="cambiarBajaEquipo">
	UPDATE equipo
	SET dadoDeBaja = #{dBaja}
	WHERE numero = #{nume}
  </update>
</mapper>
